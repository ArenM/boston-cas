- if @active_filter
  - filter_class = 'filter-sort__filter-active'
- else
  - filter_class = 'filter-sort__filter'
.btn-group{class: filter_class}
  %button.btn.btn-default.dropdown-toggle{data: {toggle: 'dropdown'}}
    Filter
    %span.caret
  .dropdown-menu.dropdown-menu-right.options
    %p Limit clients by dates served
    - if false
      form_tag(nil, method: "get") do
      .row
        .col-xs-5
          .input-group.date{data: {provide: :datepicker}, style: 'margin-bottom: 20px;'}
            %input.form-control{name: :start_date, type: :date, value: @start_date}
            %span.input-group-addon.icon-calendar
        .col-xs-1{style: 'padding-top: 5px;'}
          to
        .col-xs-5
          .input-group.date{data: {provide: :datepicker}, style: 'margin-bottom: 20px;'}
            %input.form-control{name: :end_date, type: :date, value: @end_date}
            %span.input-group-addon.icon-calendar
      .row
        .col-xs-10
          %p
            %select{name: :data_source_id}
              %option{value: ''} Filter by Data Source
              - GrdaWarehouse::DataSource.importable.each do |ds|
                - selected = @data_source_id == ds.id
                %option{value: ds.id, selected: selected}= ds.name
      .row
        .col-xs-6
          %p
            %button.btn.btn-primary.icon-filter{type: :submit} Filter
        .col-xs-6.text-right
          %p= link_to ' Clear Filters', clients_path, class: 'btn btn-secondary icon-cross'
= content_for :page_js do
  :javascript
    $('select').select2();
    (function($) {
      function toggle_clickable(e) {
        if($(e.target).closest('.filter-sort__filter').length == 0 ) {
          $('.filter-sort__filter').data('closeable', true);
        }
      }
      $('.filter-sort__filter').on('hide.bs.dropdown', function (e) {
        var closable = $(this).data('closeable');
        if(closable) {
          $('body').off('click', toggle_clickable);
        }
        return closable;
      });
      $('.filter-sort__filter').on('show.bs.dropdown', function (e) {
        $(this).data('closeable', false);
        // Make clicking outside of the menu close the menu
        $('body').on('click', toggle_clickable);
      });
      $('.filter-sort__filter').on('click', '*', function(e) {
        var $target = $(e.target);
        var closeable = $target.parent().data('closeable');
        if($target.hasClass('dropdown-toggle') && closeable == false) {
          $target.parent().data('closeable', true);
        }
      });
    })(jQuery);
    